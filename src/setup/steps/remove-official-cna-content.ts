import { promises as fs } from "fs"
import { exitWithError } from "../../helpers/exit-with-error"
import { remove } from "../../helpers/remove"
import { commandInstance } from "../../instance"
import { Step } from "../step"

/**
 * Removes the content generated by the official Create Next App CLI tool.
 */
export const removeOfficialCNAContentStep: Step = {
  shouldRun: async () => true,

  didRun: false,

  run: async () => {
    const instance = commandInstance.get()
    instance.log("Cleaning up official Next.js boilerplate...")

    try {
      await Promise.all([
        remove("pages"),
        remove("styles"),
        remove("public/vercel.svg"),
        remove("README.md"),
      ])
      await fs.mkdir("pages")
    } catch (error) {
      exitWithError(
        "An error occurred while removing the content generated by the official Create Next App CLI tool.",
        error
      )
    }
  },
}
